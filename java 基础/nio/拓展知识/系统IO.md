## 操作系统IO原理

### 物理内存与虚拟内存

1、物理内存就是RAM，还有一个存储单元叫做寄存器，连接处理器和RAM或者寄存器的是地址总线，这个地址总线的宽度影响了物理地址的索引范围，``32``位地址总线可以寻址4gb内存。

 2` `除了硬件程序或者驱动程序需要直接访问存储器外，大部分情况下都是通过操作系统提供的接口来访问内存，在java中甚至不需要写和内存相关的代码。

 3` `不管是在windows还是linux，我们运行程序都要向操作系统申请内存地址，通常操作系统管理内存的申请空间是按照进程来管理的。每个进程拥有一个独立的地址空间，逻辑上是隔离的。

 4` `但是由于系统内存有限，物理空间需要得到更有效的利用，于是进程在物理上是共享物理内存的。

 5` `为了实现这一目的，操作系统设计了虚拟内存的概念，每个进程有一个很大的虚拟地址空间，虚拟地址可以让进程共享物理内存，提高利用率，也可以让进程独享大段虚拟地址空间。



### 页面和页面置换

进程在不活动的时候，把物理内存中的数据存在磁盘文件中。在windows中就是页面文件，在linux中则是swap分区。真正高效的物理内存留给正在活动的程序使用。

当我们唤醒一个很长时间没有使用的程序时，磁盘会吱吱作响，因为此时在进行页面调度，这种情况需要避免经常出现，否则效率会很低。如果linux上的swap分区被频繁使用，则系统会非常慢，说明物理内存可能严重不足或者某些程序没有释放内存。



### 内核空间与用户空间

计算机有一定大小的内存空间，比如4GB,这些地址空间并不能被用户程序完全使用。因为有一部分空间是内核空间。

内核空间主要是操作系统运行时所使用的用于进程调度，虚拟内存的使用或者硬件资源等的程序逻辑。

为了保证系统的稳定性和安全性，必须划分为两个空间。

访问硬件资源如网络逻辑，执行IO读取磁盘数据等操作，都需要通过系统调用来完成，系统调用就是执行操作系统提供的接口。

而操作系统和硬件之间的交互一般是基于指令集来完成的，机器码根据指令集进行译码，cpu根据指令完成对应的操作，比如访问内存，执行IO操作，以及访问硬件等等。



### 系统调用

 执行系统调用的时候，需要进行两个内存空间的切换，经常需要在两个内存空间之间进行内容复制。这牺牲了一部分效率，Linux系统sendfile文件传输方式，可以减少这种内核空间到用户空间的数据复制方式。 